<?xml version="1.0" encoding="UTF-8"?>
<solver>
    <solutionClass>com.example.domain.SchoolSchedule</solutionClass>
    <!-- UPDATED: Changed from CourseAssignment to CourseBlockAssignment for block-based scheduling -->
    <entityClass>com.example.domain.CourseBlockAssignment</entityClass>
    <scoreDirectorFactory>
        <constraintProviderClass>com.example.solver.SchoolConstraintProvider</constraintProviderClass>
    </scoreDirectorFactory>

    <!-- Phase 1: Construction Heuristic -->
    <!-- FIRST_FIT processes block assignments in natural order (by group, course, blockLength).
         This is optimal for pre-assigned data where teachers and rooms are already set,
         and only block timeslots need assignment. Natural ordering helps distribute blocks
         efficiently across the schedule. -->
    <constructionHeuristic>
        <constructionHeuristicType>FIRST_FIT</constructionHeuristicType>
    </constructionHeuristic>

    <!-- Phase 2: Local Search (Improvement) -->
    <!-- Uses multiple algorithms for better exploration:
         - Late Acceptance: Good for escaping local optima
         - Tabu Search: Prevents cycling back to recent solutions -->
    <localSearch>
        <unionMoveSelector>
            <!-- Change 1 variable (timeslot) -->
            <changeMoveSelector/>
            <!-- Swap assignments between two entities -->
            <swapMoveSelector/>
            <!-- Pillar swap: swap groups of assignments with same value -->
            <!-- <pillarSwapMoveSelector/> -->
        </unionMoveSelector>
        <acceptor>
            <!-- Late Acceptance: accepts moves based on score from N steps ago -->
            <lateAcceptanceSize>1000</lateAcceptanceSize>
            <!-- Tabu Search: prevents cycling back to recent solutions -->
            <entityTabuSize>7</entityTabuSize>
        </acceptor>
        <forager>
            <acceptedCountLimit>1</acceptedCountLimit>
        </forager>
        <termination>
            <!-- Stop when we find a feasible solution (0 hard violations) -->
            <bestScoreLimit>0hard/*soft</bestScoreLimit>
            <!-- Or after 10 minutes total -->
            <minutesSpentLimit>1</minutesSpentLimit>
            <!-- Or after 3 minutes without improvement -->
            <unimprovedMinutesSpentLimit>1</unimprovedMinutesSpentLimit>
        </termination>
    </localSearch>
</solver>
